<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book Your Stay - The HillSide Oasis</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 40px;
      color: #2c3e50;
    }
    
    .header h1 {
      font-family: 'Playfair Display', serif;
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    
    .booking-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-top: 30px;
    }
    
    .calendar-section, .booking-form-section {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }
    
    .section-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.8rem;
      margin-bottom: 20px;
      color: #4c9963;
    }
    
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      margin-top: 20px;
    }
    
    .calendar-header {
      text-align: center;
      font-weight: 600;
      padding: 10px;
      background: #4c9963;
      color: white;
      border-radius: 5px;
      font-size: 0.9rem;
    }
    
    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      font-weight: 500;
    }
    
    .calendar-day:hover:not(.disabled):not(.booked) {
      border-color: #4c9963;
      background: #f0f8f4;
      transform: scale(1.05);
    }
    
    .calendar-day.selected {
      background: #4c9963;
      color: white;
      border-color: #4c9963;
    }
    
    .calendar-day.disabled {
      background: #f5f5f5;
      color: #ccc;
      cursor: not-allowed;
    }
    
    .calendar-day.booked {
      background: #ffebee;
      border-color: #ef5350;
      cursor: not-allowed;
    }
    
    .calendar-day.booked::after {
      content: '✕';
      position: absolute;
      color: #ef5350;
      font-size: 1.2rem;
    }
    
    .month-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .month-nav button {
      background: #4c9963;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .month-nav button:hover {
      background: #3d7a4f;
      transform: translateY(-2px);
    }
    
    .month-nav span {
      font-weight: 600;
      font-size: 1.2rem;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #2c3e50;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
      transition: all 0.3s;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #4c9963;
      box-shadow: 0 0 0 3px rgba(76, 153, 99, 0.1);
    }
    
    .room-selector {
      display: grid;
      gap: 15px;
      margin-top: 10px;
    }
    
    .room-option {
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .room-option:hover {
      border-color: #4c9963;
      background: #f0f8f4;
    }
    
    .room-option.selected {
      border-color: #4c9963;
      background: #f0f8f4;
    }
    
    .room-option input[type="radio"] {
      margin-right: 10px;
    }
    
    .room-details {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .room-name {
      font-weight: 600;
      color: #2c3e50;
    }
    
    .room-price {
      font-weight: 700;
      color: #4c9963;
    }
    
    .booking-summary {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
    }
    
    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    
    .summary-row.total {
      font-weight: 700;
      font-size: 1.2rem;
      color: #4c9963;
      padding-top: 10px;
      border-top: 2px solid #e0e0e0;
    }
    
    .submit-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #4c9963 0%, #6fb583 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(76, 153, 99, 0.3);
    }
    
    .submit-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    
    .legend {
      display: flex;
      gap: 20px;
      margin-top: 20px;
      font-size: 0.9rem;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .legend-box {
      width: 20px;
      height: 20px;
      border-radius: 4px;
    }
    
    .legend-box.available {
      border: 2px solid #4c9963;
      background: white;
    }
    
    .legend-box.booked {
      background: #ffebee;
      border: 2px solid #ef5350;
    }
    
    .legend-box.selected {
      background: #4c9963;
    }
    
    .alert {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .alert-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .alert-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    @media (max-width: 968px) {
      .booking-container {
        grid-template-columns: 1fr;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .calendar {
        gap: 5px;
      }
      
      .calendar-day {
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Book Your Mountain Retreat</h1>
      <p>Select your dates and choose your perfect accommodation</p>
    </div>
    
    <div class="booking-container">
      <!-- Calendar Section -->
      <div class="calendar-section">
        <h2 class="section-title">Select Your Dates</h2>
        
        <div class="month-nav">
          <button id="prevMonth">← Previous</button>
          <span id="currentMonth">December 2025</span>
          <button id="nextMonth">Next →</button>
        </div>
        
        <div class="calendar" id="calendar"></div>
        
        <div class="legend">
          <div class="legend-item">
            <div class="legend-box available"></div>
            <span>Available</span>
          </div>
          <div class="legend-item">
            <div class="legend-box booked"></div>
            <span>Booked</span>
          </div>
          <div class="legend-item">
            <div class="legend-box selected"></div>
            <span>Selected</span>
          </div>
        </div>
      </div>
      
      <!-- Booking Form Section -->
      <div class="booking-form-section">
        <h2 class="section-title">Booking Details</h2>
        
        <div id="alertContainer"></div>
        
        <form id="bookingForm">
          <div class="form-group">
            <label>Check-in Date *</label>
            <input type="text" id="checkinDisplay" readonly required>
          </div>
          
          <div class="form-group">
            <label>Check-out Date *</label>
            <input type="text" id="checkoutDisplay" readonly required>
          </div>
          
          <div class="form-group">
            <label>Number of Nights</label>
            <input type="text" id="nights" readonly>
          </div>
          
          <div class="form-group">
            <label>Choose Your Room *</label>
            <div class="room-selector">
              <div class="room-option" data-room="sky" data-price="4500">
                <input type="radio" name="room" value="sky" id="room-sky" required>
                <div class="room-details">
                  <span class="room-name">Sky Suite (2 Guests)</span>
                  <span class="room-price">₹4,500/night</span>
                </div>
              </div>
              <div class="room-option" data-room="hillside" data-price="5200">
                <input type="radio" name="room" value="hillside" id="room-hillside">
                <div class="room-details">
                  <span class="room-name">Hillside Suite (2-3 Guests)</span>
                  <span class="room-price">₹5,200/night</span>
                </div>
              </div>
              <div class="room-option" data-room="family" data-price="7800">
                <input type="radio" name="room" value="family" id="room-family">
                <div class="room-details">
                  <span class="room-name">Family Cottage (4-6 Guests)</span>
                  <span class="room-price">₹7,800/night</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="booking-summary" id="bookingSummary" style="display:none;">
            <div class="summary-row">
              <span>Room Rate:</span>
              <span id="roomRate">₹0</span>
            </div>
            <div class="summary-row">
              <span>Number of Nights:</span>
              <span id="nightsCount">0</span>
            </div>
            <div class="summary-row total">
              <span>Total Amount:</span>
              <span id="totalAmount">₹0</span>
            </div>
          </div>
          
          <div class="form-group">
            <label>Full Name *</label>
            <input type="text" name="name" required>
          </div>
          
          <div class="form-group">
            <label>Email Address *</label>
            <input type="email" name="email" required>
          </div>
          
          <div class="form-group">
            <label>Phone Number *</label>
            <input type="tel" name="phone" required>
          </div>
          
          <div class="form-group">
            <label>Number of Guests *</label>
            <input type="number" name="guests" min="1" required>
          </div>
          
          <div class="form-group">
            <label>Special Requests</label>
            <textarea name="requests" rows="4" placeholder="Any dietary requirements, accessibility needs, or special occasions?"></textarea>
          </div>
          
          <button type="submit" class="submit-btn" id="submitBtn">Complete Booking</button>
        </form>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    // STEP 1: ADD YOUR WEB APP URL HERE
    // ============================================
    const API_URL = 'https://script.google.com/macros/s/AKfycbyFl_L1GDwkl0wWttThf_smzYTY0ZL1uuhiuaZ2Im6X_1jA6xdZNB_BWClRLfC7fNs5mA/exec';
    // Example: 'https://script.google.com/macros/s/AKfycbx.../exec'
    
    // Booking state
    let currentMonth = new Date(2025, 11, 1); // December 2025
    let checkinDate = null;
    let checkoutDate = null;
    let selectedRoom = null;
    let roomPrice = 0;
    
    // Simulated bookings - In production, fetch from backend
    const bookedDates = {
      '2025-12-20': ['sky', 'hillside'],
      '2025-12-21': ['sky'],
      '2025-12-25': ['sky', 'hillside', 'family'],
      '2025-12-26': ['sky', 'hillside', 'family'],
      '2026-01-01': ['hillside']
    };
    
    // Initialize calendar
    function initCalendar() {
      const calendar = document.getElementById('calendar');
      const monthDisplay = document.getElementById('currentMonth');
      
      // Update month display
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                         'July', 'August', 'September', 'October', 'November', 'December'];
      monthDisplay.textContent = `${monthNames[currentMonth.getMonth()]} ${currentMonth.getFullYear()}`;
      
      // Clear calendar
      calendar.innerHTML = '';
      
      // Add day headers
      const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      dayNames.forEach(day => {
        const header = document.createElement('div');
        header.className = 'calendar-header';
        header.textContent = day;
        calendar.appendChild(header);
      });
      
      // Get first day of month
      const firstDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1);
      const lastDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 0);
      const startDay = firstDay.getDay();
      
      // Add empty cells
      for (let i = 0; i < startDay; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'calendar-day disabled';
        calendar.appendChild(emptyCell);
      }
      
      // Add days
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      for (let day = 1; day <= lastDay.getDate(); day++) {
        const date = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), day);
        const dateStr = formatDate(date);
        const dayCell = document.createElement('div');
        dayCell.className = 'calendar-day';
        dayCell.textContent = day;
        dayCell.dataset.date = dateStr;
        
        // Disable past dates
        if (date < today) {
          dayCell.classList.add('disabled');
        }
        // Mark booked dates
        else if (bookedDates[dateStr] && selectedRoom && bookedDates[dateStr].includes(selectedRoom)) {
          dayCell.classList.add('booked');
        }
        // Handle selection
        else {
          dayCell.addEventListener('click', () => selectDate(date, dayCell));
        }
        
        // Highlight selected dates
        if (checkinDate && formatDate(checkinDate) === dateStr) {
          dayCell.classList.add('selected');
        }
        if (checkoutDate && formatDate(checkoutDate) === dateStr) {
          dayCell.classList.add('selected');
        }
        
        calendar.appendChild(dayCell);
      }
    }
    
    function formatDate(date) {
      return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
    }
    
    function formatDisplayDate(date) {
      const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
      return date.toLocaleDateString('en-US', options);
    }
    
    function selectDate(date, cell) {
      if (!checkinDate || (checkinDate && checkoutDate)) {
        // Start new selection
        checkinDate = date;
        checkoutDate = null;
        document.getElementById('checkinDisplay').value = formatDisplayDate(date);
        document.getElementById('checkoutDisplay').value = '';
        document.getElementById('nights').value = '';
      } else if (date > checkinDate) {
        // Set checkout
        checkoutDate = date;
        document.getElementById('checkoutDisplay').value = formatDisplayDate(date);
        calculateNights();
      } else {
        // Reset if selecting earlier date
        checkinDate = date;
        checkoutDate = null;
        document.getElementById('checkinDisplay').value = formatDisplayDate(date);
        document.getElementById('checkoutDisplay').value = '';
        document.getElementById('nights').value = '';
      }
      
      initCalendar();
      updateBookingSummary();
    }
    
    function calculateNights() {
      if (checkinDate && checkoutDate) {
        const nights = Math.ceil((checkoutDate - checkinDate) / (1000 * 60 * 60 * 24));
        document.getElementById('nights').value = `${nights} night${nights > 1 ? 's' : ''}`;
        updateBookingSummary();
      }
    }
    
    function updateBookingSummary() {
      if (checkinDate && checkoutDate && selectedRoom) {
        const nights = Math.ceil((checkoutDate - checkinDate) / (1000 * 60 * 60 * 24));
        const total = nights * roomPrice;
        
        document.getElementById('bookingSummary').style.display = 'block';
        document.getElementById('roomRate').textContent = `₹${roomPrice.toLocaleString()}`;
        document.getElementById('nightsCount').textContent = nights;
        document.getElementById('totalAmount').textContent = `₹${total.toLocaleString()}`;
      } else {
        document.getElementById('bookingSummary').style.display = 'none';
      }
    }
    
    function showAlert(message, type) {
      const alertContainer = document.getElementById('alertContainer');
      alertContainer.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
      setTimeout(() => {
        alertContainer.innerHTML = '';
      }, 5000);
    }
    
    // Event listeners
    document.getElementById('prevMonth').addEventListener('click', () => {
      currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1, 1);
      initCalendar();
    });
    
    document.getElementById('nextMonth').addEventListener('click', () => {
      currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1);
      initCalendar();
    });
    
    document.querySelectorAll('.room-option').forEach(option => {
      option.addEventListener('click', function() {
        document.querySelectorAll('.room-option').forEach(opt => opt.classList.remove('selected'));
        this.classList.add('selected');
        this.querySelector('input').checked = true;
        
        selectedRoom = this.dataset.room;
        roomPrice = parseInt(this.dataset.price);
        
        initCalendar(); // Refresh to show room-specific availability
        updateBookingSummary();
      });
    });
    
    document.getElementById('bookingForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (!checkinDate || !checkoutDate) {
        showAlert('Please select check-in and check-out dates', 'error');
        return;
      }
      
      if (!selectedRoom) {
        showAlert('Please select a room', 'error');
        return;
      }
      
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Processing...';
      
      const formData = new FormData(e.target);
      const bookingData = {
        checkin: formatDate(checkinDate),
        checkout: formatDate(checkoutDate),
        room: selectedRoom,
        roomPrice: roomPrice,
        totalAmount: Math.ceil((checkoutDate - checkinDate) / (1000 * 60 * 60 * 24)) * roomPrice,
        name: formData.get('name'),
        email: formData.get('email'),
        phone: formData.get('phone'),
        guests: formData.get('guests'),
        requests: formData.get('requests')
      };
      
      // ============================================
      // STEP 2: SEND DATA TO GOOGLE SHEETS
      // ============================================
      try {
        // Check if API_URL is configured
        if (API_URL.includes('PASTE_YOUR')) {
          throw new Error('Please configure API_URL at the top of the script');
        }
        
        // Send booking to Google Sheets
        const response = await fetch(API_URL, {
          method: 'POST',
          mode: 'no-cors', // Required for Google Apps Script
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(bookingData)
        });
        
        // With no-cors mode, we can't read the response
        // So we assume success if no error was thrown
        showAlert('Booking request submitted successfully! Check your email for confirmation within 24 hours.', 'success');
        
        // Reset form
        e.target.reset();
        checkinDate = null;
        checkoutDate = null;
        selectedRoom = null;
        document.getElementById('checkinDisplay').value = '';
        document.getElementById('checkoutDisplay').value = '';
        document.getElementById('nights').value = '';
        document.querySelectorAll('.room-option').forEach(opt => opt.classList.remove('selected'));
        initCalendar();
        updateBookingSummary();
        
        // Scroll to top to show success message
        window.scrollTo({ top: 0, behavior: 'smooth' });
        
      } catch (error) {
        console.error('Booking error:', error);
        showAlert('Unable to process booking online. Please call us at +91 91503 60597 or WhatsApp to complete your booking.', 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Complete Booking';
      }
    });
    
    // Initialize on page load
    initCalendar();
  </script>
</body>
</html>